---
title: "Notes Functional Genomics"
author: "Jorge"
date: "1/15/2021"
output:
  pdf_document: default
  html_document: default
---
### Notes

## Introduction

The impact of network science has been at a global scale, not only on biological sciences or science itself. In recent years, there has been boom around the network sciences. The usefulness of network sciences has had an impact in economic, social, scientific, and many other areas. At first, the armies were the first investors in the develpoment of networks in order to avoid terrorist attacks in their countries.

## Complexity as a defined science

It refers to something that is interconnected with many other objects, it has many parts of "one" thing. It is an emergent science with a wide range 

## Graph Theory

-Network definition: Group or system that are interconnected by any possible 

## Networks

-A network is defined as G=(V,E); where V=vertex/nodes, E=edges/connections.

-The connections may not be direct relationships, such as physical ones, they may be just connections as a link in a website.

-Vertex/nodes: people, species, metabolites, proteins, genes, neurons, etc.

-Edges: 

## Network architecture, topological properties

# Degree, Average Degree and Degree distribution

# Degree:

-Select a node, is the number of connections each node has. It is expressed as Ki, where i is the number of the node itself.

-Es una propiedad local

# Aveage Degree:

-Número de conexiones promedio que tiene la red completa.

-Sumo las conexiones totales y simplemente divido en el total de nodos habidos.

-Es una propiedad global, es decir, de toda la red.

# Degree Distribution:

-Se calcula con un histograma

-Probabilidad que al tomar un nodo al azar, tenga un número de conexiones específico. Calculo el número de nodos con sus respectivas conectividades, entre el número de nodos. Ej. Probabilidad de tomar un nodo que al azar tenga dos conexiones, o una, etc.

-Redes complejas tienen una distribución diferente, muchos que no tienen dmasiadas conexiones, pero hay unos cuantos que tienen muchas (hubs). Son una distribución de cola larga.

#######here an exercise and formulas

## Representar una red

# Adjancy matrix

-Podemos calcular con mayor facilidad

-Ver quiénes son vecinos de cada uno

-Es una matriz cuadrada. Definimos entrada, Mij, i puede ser cualquier entrada y j el nodo a evaluar. Ej. M12, el nodo uno conecta con el nodo dos? si hay un 1, entonces si, si hay un 0 entonces no.

### Undirected network

-Dirección no importa, las conexiones son en ambas direcciones. Si A se conecta con B, entonces B se conecta con A. Es lo mismo decir A-B, que B-A. 

-Da una matriz simétirca.

Ej: Red de actores, de co-autores, de co-expresión de genes

### Directed networks

-Importa la dirección de la relación.

-Si A se conecta con B, B no tiene que conectarse con A forzosamente.

-Ej. Seguidores en Twitter, citas de artículos, red de regulación de genes

### Weighted networks

-Damos pesos, no ponemos que son forzosameente relaciones recíprocas o no.

-Valores de 0 a 1.

-Ej. Redes de correlación de organismos, red probabnilística Booleana.


## Real Networks are Sparse

-Redes biológicas no tienden a estar 100% conectadas

-Las conexiones biológicas se laejan mucho del número totla posible de conexiones.

## Bipartite networks

-Dos clases de nodos distinguibles.

-Ej. Polinizadores y plantas, los polinizadores son una clase de nodo y las plantas son otro tipo.

-Ej. Redes regulatorias de miRNA-genes

-Puede haber tripartitas y así


### Exercises to try and figure out the gist of igraph
```{r}
library(igraph)
g_1<-make_empty_graph(n=10, directed = T)#make an empty network
g_1
V(g_1)$color="blue"#color of the shape
V(g_1)$shape="square"#shape

plot(g_1)
g_1<-add.edges(g_1, c(1,3, 1,4, 1,7, 2,3, 2,5, 3,9, 4,8, 6,2, 6,10))#add the connections
g_1<-add.vertices(g_1, 2, color="green", shape="square")#may add another "point"
plot(g_1)

class(g_1)#it hass its own class
str(g_1)#shows the structure of the network itself

g_2<-delete.edges(g_1, c(1))#delete the connection with the selected number
plot(g_2)
g_2<-add.edges(g_2, c(1,10, 11,12))#add any edge you want
plot(g_2)


V(g_2)$name<- letters[10:21]#may add the names I want
E(g_1)#shows the connections
V(g_2)#shows the names of the nodes and # of vertex

#Degree
degree(g_2)#shows the degree of each node
plot(g_2, layout=layout_nicely, vertex.size=degree(g_2, V(g_2), "in")*15+20,
     vertex.label.dist=0.5, edge.arrow.size=.5)
hist(degree(g_2), col = 4)

#Degree distribution
plot(degree.distribution(g_2), main="Degree Distribution", 
     xlab="Degree", ylab="Frequency", col=c(2:5), pch=20, lwd=4)


#Matrix
adj_mat<-as.matrix(get.adjacency(g_2))#the adjancy matrix shows the connections of the vertex, shows the matrix in different representation
adj_mat
get.adjacency(g_2)

#Default (may use to practice)
g_3<-make_star(20)
g_3
plot(g_3)
plot(make_ring(10))
g_4<-make_ring(10, directed = T)
g_4
plot(g_4)
plot(make_kautz_graph(2,3))

#heatmap
heatmap(adj_mat, Rowv=NA, Colv="Rowv")
```

## First exercises with friends network
```{r}
library(igraph)
fr<-read.csv("RedDeAmistadesGF2021Nombres - Hoja 1.csv")
rownames(fr)<-fr[,1]
fr_mat<-as.matrix(fr[,-1])
diag(fr_mat)<-rep(0,19)

red_1<-graph_from_adjacency_matrix(fr_mat)
red_1
plot(red_1)
degree(red_1, mode="in")
sort(degree(red_1, mode="in"), decreasing = T)
sort(degree(red_1, mode="out"))
plot(cluster_spinglass(red_1),red_1)

hist(degree(red_1,mode="in"), col=c(1:length(hist(degree(red_1, mode="in")))))
hist(degree(red_1,mode="out"), col=c(1:length(hist(degree(red_1, mode="out")))))
```

## Paths and Distances

# Paths

Son trayectorias de un nodo a otro. Caminos de los nodos conectados desde uno a otro, son selecciones arbitarias. Es una propiedad local. En caso de redes no dirigidas no hay problemas, pero en redes dirigidas hay que mantener las direcciones

# Shortest paths (Distances)

Es la menor cantidad de pasos/conexiones que te pueden llevar de un punto a otro mediante las conexiones.

# Average distances

A partir de un nodo arbitrario, determinar la distancia de todos los nodos y hacer el promedio de dichas distancias. Es una propiedad global.

# 


# Clustering coefficient

Ver si a partir de un nodo conectado con otros, hay conexiones entre los nodos que se conectan. De 0-1. #Recordar ver la fórmula# n(n-1)/2

## Second exercises with friends network
```{r}
library(igraph)

#Distances

shortest.paths(red_1)#shortest path between a node and the others
distances(red_1, v= "ANA", to="ENOE")#may select a single node to other
diameter(red_1)
mean_distance(red_1)
get_diameter(red_1, directed = T)
transitivity(red_1)

plot(red_1,layout=layout.fruchterman.reingold(red_1), 
     vertex.size=5, edge.arrow.size=.2)
###
g <- barabasi.game(1000, power=1)
plot(g,layout=layout.fruchterman.reingold(g), 
     vertex.size=5, edge.arrow.size=.2)
###

mat.1<-shortest.paths(red_1)#apparently seems to be a matrix by default
heatmap(mat.1)
shortest_paths(red_1,1,6)
all_shortest_paths(red_1, 1,2:6)
```


## Scale-Free property

Se pensaba que los nodos nuevos een una red se unían  de modo aleatorio, pero no es así, no es unimodal con promedio bien determinado. El promedio no es una buena escala para determinar la conectividad, no describe la red. En las redes reales hay nodos que concentran mucho (hubs), y hay muchos más que conectan poco (Distribución de cola larga/ Sin escala). Tanto redes dirigidas como no dirigidas cumplen con nesta propiedad, lo cual significa que es una propiedad/ley de universalidad; o sea, patrones que se cumplen de manera generalizada.

## Preferential attachment

Es más probable que un nodo siga la misma tendencia general, no asignarse de modo azaroso; es decir, si los nodos tienen más conexiones es más probable que sigan teniendo más conexiones y que los de pocas conexiones se mantengan iguial. Los nuevos nodos es más probable que se conecten a los hubs o nodos que tienen un mayor degree.

## Network robustness

Se mide con base en remover un nodo/conexión al azar y ver qué tanto se afecta la estructura de la red. En teoría, una red robusta no debería de cambiar demasiado cuando se remueven los nodos, debería de seguir teniendo conectividad aunque sea a mayores distancias. El cambio en el valor del diámetro es útil para medir la robustez de la red. Las redes scale-free tienden a ser robustas. La redundancia es un buen método de generar robustez, redundancia en sistemas biológicos ayuda a que no decaiga todo en caso de un fallo, sea dirigido o azaroso.

## Redundancy

Existen caminos que pese a remover nodos o algunas conexiones, las conexiones restantes permitan todavía la conexiónentre los nodos de la red. 

## Centralities

Es la medida de importancia de los nodos, su centralidad en cuestión de la estrucutra de la red. Aunque al parecer también se puede referir a literalmente estar en el centro de la estructura de la red. Haydiferentes modos de medir la centralidad, y cada método mide diferentes cosas para obtener su valor de centralidad. Por ejemplo, puede medirse la centralidad en relación a las conexiones que tiene un nodo. Dependiendo de lo que queremos saber, es el modo de calcular centralidad que se usa.

# Degree centrality
Es en cuanto lamedida de conexiones que posee el nodo.

# Eccentricity
Es la medida de distancia que tiene con un centro cualquier nodo. Consideras la disntancia máxima de cada nodo, el nodo central va a ser el que tenga una distancia máxima menor, es decir, el menos excéntrico.

# Closeness centrality
Medimos el que tiene distancias más cercanas. Calculamos la distancia de los nodos al resto, tomamos los valores más pequeños y les sacamos la inversa. 

## Communities
Redes tienden a formar comunidades/clusters. Pertenencia a un cluster significa que está más conectado con los elementos del cluster que con el resto, pero esto no significa que no puedan estar conectados.

# Definiciones de comunidades:

#Cliques:
Subcomunidades dentro de una comunidad quee están muy unidos, con coeficiente de clusterización de 1 o cercano. Pueden estar conectados con más nodos dentro de la comunidad, pero son un pequeño grupo alatamente interconectado. 

#Strong communities/cluster:
Subgrafo  cuyos nodos están conectados entre los mismos nodos de la comunidad, más que con miembros de otra comunidad.

## Métodos de clusterización

#Edge betweenness:
Qué tan en medio están las conexiones
#Label propagation:
Es estocástico, tener cuidado. Es por propagación por cercanía con los vecinos

## Mundo ultra pequeño

El diámetro de las redes es relativamente pequeño, es decir si va aprox log(log(#de nodos)). En redes biológicas es muy presente debido a redundancias y niveles de conexión que tienen los nodos.

## Motifs

Son motivos. Son subgrupos de una red que aparecen más de lo que deberían de aparecer por azar. Elementos recurrentes que en una red al azar no deberían de ocurrir. Tienen una razón detrás de esos motivos, el ejemplo de de arreglos de tres en regulaciones trasncripcionales. Los motivos están presentes y han evitado desaparecer conforme el paso del tiempo.

## Interactoma

Es el conjunto de todas las proteínas y sus interacciones

## Red de interacción proteína-proteína (PPI)

Los nodos son proteínas, las conexiones es si hay interacción entre ellas, es una red no dirigida. La información para formar estas redes es con base en cristalografía de rayos X, NMR, Tandem Affinity Purification, Coinmunoprecipitación, Yeast two-Hybrid (Y2H, es de las más comúnes de hacer). Estas redes las encontramos en distintos sitios (Aparecen en las diapos), una de las más completas es "STRING". Casi siempre nos vamos a referir a qué tanto interactúan proteínas.

# ¿Para qué sirven?
Saber si las interacciones son estables y se forman complejos proteicos; saber si son de interacciones transitorias y breves que generan modificaciones en alguna proteína (son lo más dinámico del interactoma). Podemos asignar roles a proteínas cuya función era desconocida (es teórico, requiere comprobarse), añadir detalles cerca de los pasos en una vía de señalización, caracterizar complejos de proteínas.

# Propiedades topológicas
Son free-scale (cola larga, igualmente robustos), son de mundo ultra-pequeño (distancia va aprox log(log(nodos))). Los módulos son unidades funcionales *Checar bien esta parte*

## Redes de co-expresión
Hay distintos tipos de redes de genes, y pueden ser pesadas, direccionadas, sin direccionar, etc. En este caso de co-expresión, se refiere a que los perfiles de expresión son parecidos, por ejemplo, los microarreglos y la intensidad de luz que da la intensidad de expresión. Se presentan niveles de expresión no similares, pero que su comportamiento es parecido, suben y bajan por así decirlo al mismo tiempo; pero no forzosamente al mismo nivel. Una medida es ver el nivel de correlaciones de expresión, se da en matrices de correlación. Entre más sea cercano el valor a uno, pues están correlacionados, cuando están cerca de menos uno están anticorrelacionado, si es cercano a 0, no tienen correlación; es obvio. El punto en el que decidimos si está correlacionado o no, es arbitrario. Se puede usar entropía de Shannon, donde sé datos de mi variable x, cuánto me da de información de y; debe de dar variables mayores a 0, pero puede ser a infinito. Algorito ARACNE es para información mutua de genes. Las redes de co-expresión son no dirigidas.

## Redes dinámicas de genes/ Redes booleanas (bipartitas)

Nodos son genes y las conexiones son el producto de los genes que a su vez pueden regula transcirpción. Pueden activar o inhibir. Las dos clases son los genes y los productos como tal. Basado en álgebra Booleana. Tres operadores básicos que unen proposiciones, que establecen valores de verdadero o falso no ambiguos. AND|OR|NOT. Los operadores forman las proposiciones. Las tablas de verdad, vienen los valores que pueden tener. Son redes dinámicas basadas con operadores AND, OR, NOT. Vemos en tiempos discretos los atractores de la red y corroboramos con observaciones.

## Redes genéticas regulatorias

Nodos son genes, conexiones son de regulacipon con dos signos, activar o inhibir. Usamos operadores booleanos en las redes. Tantas funciones booleanas como nodos; debemos de poner las condiciones que activan a los nodos. Genes activos con base en los niveles de expresión, se dan condiciones de prendido y apagado con las relaciones, son 0´s y 1´s. Las interacciones son dinámicas, y permite elucidar comportamientos dependiendo del estado activo o inactivo de algunos de los nodos. Número posible de estados de la red es 2^N. Cuando después de las iteraciones, la red parece alcanzar un estado estable en la activación e inactivación de sus nodos, se llama equilibrio, se va a ATRACTORES (pueden ser puntiales o cíclicos). Es parecido a lo que hacíamos en mate con los puntos de equilibrio. Cuenca de atracción: path de estados que llevan al ataractor. Requerimos una lista de genes, preferentemente con actividad comprobada, y ponemos 

## librería de wgcna

## Microarreglos

Microarreglos de expresión. Medimos la expresión de muchos genes de modo simultáneo. Era una técnica hace 15 años muy novedosa e importante, hoy ya no tanto. Tiene varias desventajas y por eso está en desuso. Una placa de plástico con sondas y se usaba para medir fluorescencia en caso de la presencia, pero dependía del contenido de DNA en la placa. La idea era que cada pozo de la placa fuera una región de DNA y su hibridación con nuestramuestra, nos arrojaba fluorescencia para nosotros medir la expresión. Se obtenía una imagen con los colores para posteriormente trasladar los valores de fluorescencia a valores de expresión. Ya no está en uso. Se usaban en distintos modos, como ver la expresión de genes de dos (o más) condiciones, referencia y experimental; también para casificar molecularmente enfermedades, identificar genes característicos de una patología, predicción de respuesta de tratamientos, ver SNP's. Ponemos DNA en sonda, nuestro RNA lo agregamos y por complementariedad van a emitir luz. Hay que normalizar los datos y hacer contabilización, esto para que pueda ser medible en mismas condiciones y ver estadísiticamente si hya cambios en la expresión o no. 
#¿Cómo medir cambios? 
1.-Establecer una condición de referencia y comparar. Se cuantifica de varios modos; la más sencilla es restarle el cambio a la condición de de referencia (da un valor y da el signo de cuál es la diferencia, pero no señala realmente una diferencia estadística). Es por esto que se puede calcular con "fold Change" C(cambio)/R(referencia), que nos arroja la magnitud del cambio, no da negativos, pero si es menor expresión, el valor es menor que 1. 
2.- Log fold-change, es sacar el logaritmo del valor del fold-change. se hace log2(C/R), se hace con base 2 el logaritmo. Cuando el resultado es de 1, significa que se expresó el doble respecto la condición de referencia; cuando es de 2, se expresó 4 veces más y así. En este caso, cuando la expresión es menor, si te arroja los signos.
#¿Cómo medir diferencias estadísticas?
Lo representamos visualmente con un volcano plot. Tiene dos ejes, en x=logFC (log fold-change, en positivos son los de mayor cambio positivo, los negtivos significa que hubo cambio pero de menor expresión (genes sobreexpresados y los subexpresados)), en y=-log10(Pvalue) (nos dice la significacnia estadística de los valores, entre más chico el valor, mejor, por eso el -log, para que nos de #'s positivos más grandes). La mayor parte de los genes no cambian mucho entre las condiciones, entonces van a estar cercanas al 0 en x; en y deben de estar por arriba de un umbral, donde el p value nos dice que son significativos. Nos interesan los que más se alejen de 0 en x y que mayor valor tengan en Y.

## RNA-seq
La tecnología de seuenciación. Mide expresión de muchos genes de manera simultánea. NGS (next generetaion sequencing). Expresiones del transcirto. Hay muchas NGS, tdas terminan con sufijo -seq; hoy en día son las tecnologías estándar para trabajar. Nos permite medir niveles de expresión de genes (lo más común), podemos describir todo lo que se transcribe, no solo lo que se traduce, caracterizar splicing alternativo y poliadenilación. Usamos un transcriptoma de referencia, nuestras lecturas que se mapean en el transcriptoma de referencia (usamos lecturas de 100 bases aprox) y se ve a qué región del genoma corresponde esa expresión; se va alineando. Los microarreglos daban imagen e interpretábamos intensidad de luz, ahora son las abundancias que mapean estos transcritos; son el número de repeticiones de fragmentos que mapean en la misma zona, aunque no deben de ser idénticos.
Pipeline general: pregunta biológica, preparación de los RNA's (aislar y purificar), preparar las bibliotyecas (cDNA en lugar de RNA y se agregan lso adaptadores), secuenciar, análisis de los short-reads. Es más snesible a los genes más y menos expresados que otros métodos; tiene menor ariación técina y aumenta su reproducibilidad, podemos descubrir nuevas regiones de expresión, expresión de splicing alternativo, expresión de un alelo específico, no tenemos dependencia de los probes en sonda, no necesitamos saber ni el genoma ni transcriptoma de manera previa forzosamente.
Se puede hacer análisis cuantitativo y cualitativo. Cualitativo: identificar sitios expresados, fronteras intrones y exones. sitios de transcripción, etc. Cuantitativo: medir difernecias de expresiónn, de splicing, etc.
#expresión diferencial de genes:
Mayor uso de RNA-seq. Métodos de análisis que permiten determinar cuantitativamente los cambios en los niveles de expresión de genes experimentales. Los pedazos de secuencia que leemos se llaman reads, casi todas son de lecturas cortas (hasta 500 pb, 100-300 es lo común), representan el mRNA fragmentado, se apunta a lecturas más largas para mayor seguridad de estar en la sección que se cree dentro del DNA. Hay algunas tecnologías que dejan hasta 1000 pb y esta con mayor seguridad y menos ambigüedad, son de lecturas largas. Podemos alinear con base en el genoma conocido, entonces está como herramienta de ver qué regiones se expresan y su frecuencia; pero igual podemos hacer un mapeo de genoma basado en algún genoma relacionado que sirva de como templete.
El repositorio de estos archivos es SRA.

#Alineamiento/mapeo
Ver en qué región del genoma caen nuestras lecturas, cuantificar las abundancias de expresión. El mapeo es lo más costoso computacionalmente y es tardado.

##Expresión de abundancia normalizada de reads/lecturas
Se debe de normalizar las abundancias debido a la longitud de los genes, porque más reads caen dentro de ese gen. Un modo común de normalizar es basado en la longitud del gen o del transcrito, contamos reads y su longitud. Hay varias herramientas para el mapeo. 
Línea de flujo de trabajo. Partimos de nuestro archivo FASTQ que contiene las lecturas de la secuencia y la calidad de la secuencia. Luego alineamiento o pseudo-alineamiento que realmente son más usados, luego cuantificamos, normalizamos y obeetnemos nuestros modelos.
FASTQ, es archivo de texto plano parecido al FASTA. Se producen por tecnologías de secuenciación, nos pone Q por quiality. Arranca con un caracter, que será @ en lugar de >, que señala un identificador; luego pone la secuencia de las lecturas cortas, peroluego tiene dos líneas adicionales. Viene un "+" que diferencia las líneas, luego viene una extra que tiene el mismo número de caracteres que la secuencia, cada signo nos menciona la calidad de la secuencia. En total debe haber un mínimo de 4 líneas, el identificador, la secuencia, el signo +, y la línea con los indicadores de la calidad. El modo de leer los identficadores de la calidad es mediante software, no es realmente parte de leerlo. Se usa la calidad QPHRED, se usa fórmula para medir la calidad, te mide el porcentaje de error, cuántaas veces se equivoca en teoría. es -10xlog10(Pe). Debe de haber un valor de 28-30 de calidad PHRED para que se considere aceptable.
Usamos software para hacer corte de calidad de las secuencias.

# Uso de kallisto
Kallisto es un pseud-alineador que nos ayuda a medio alinear las secuencias que obtenemos de los rnaseq. Tenemos nuestras lecturas y un genoma o transcriptoma de referencia, con este pseudo-alineamiento vamos teniendo una idea de qué regiones son las expresadas y su abundancia. Antes de esto, debemos de hacer la limpieza de nuestras secuencias, hacer los cortes de la secuencia que no nos sea útil, es el filtrado de calidad.
Para anlizar la expresión diferencial necesitamos los archivos fastq de lecturas de condiciones experimentales y las de referencia, necesitamos un transcriptoma de referencia y la anotación del transcriptoma.
Debemos de generar un archivo de índices, es decir "marcar" en dónde están los transcritos, para ello se utiliza el transcriptoma de referencia (obtenemos un archivo de índices). Estamos marcando en qué regiones queremos hacer que nuestros reads caigan, como decirle por qué regiones cae corresponde a qué transcrito. Marcarle las áreas donde puede caer. "kallisto index -i "nombrequequiera" -o "archivodelcualvamosasacarlareferencia"
El otro paso es mapear las lecturas respecto al archivo de índices (salida de archivos de abundancia de los transcritos). 
kallisto quant -i "archivoíndicesquegeneré" -t 3 -b 100 "todoslosarchivosdemisreads" -o "nombredearchivodeabundancias"

# BioJupies
Parecido a GEO pero con datos de RNAseq. Los archivos tienen fastQ. 

# Ontología de genes
Ya tenemos nuestros genes y ya sabes si están sobre o subexpresados.¿Cómo hacer la historia, la ontología? Vamos a hacer análisis de categorías de los genes diferencialmente expresados, establecemos el criterio para saber si está sub o sobre representado, no confundirse con expresión. Es una prueba estadística binomial. Probabilidad de los estados, son dos, pero no son .5 y .5 forzoso, necesitamos número de réplicas y número de veces que queremos que se caiga en el estado deseado; calculamos probabilidad de los eventos. Después de cuantificar las probabilidades, ya nos podemos referir a conceptos de enriquecimiento o sobre representación, es decir que aparece un mayor número de veces respecto a lo esperado; ecnontramos conjuntos más enriquecidos, están enriquecidos justo porque no aparecen al azar, están en mayor proporción de lo que el azar estipula. Agrupamos en un concepto general, los ponemos en una categoría, para siempre referirnos a una misma cosa. Repres